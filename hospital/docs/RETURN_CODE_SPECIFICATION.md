# 医院管理系统返回码规范

## 1. 概述

本文档定义了医院管理系统API的统一返回码规范，用于规范系统各模块的响应格式和错误处理，确保前端和后端之间的通信一致性和可维护性。

## 2. 统一响应格式

系统所有API接口均返回以下JSON格式：

```json
{
  "code": 0,           // 响应码，0表示成功，非0表示失败
  "msg": "success",   // 响应消息，描述请求结果
  "data": null        // 响应数据，成功时返回具体数据，失败时返回null
}
```

## 3. 返回码分类

### 3.1 系统状态码

| 返回码 | 消息 | 描述 |
|--------|------|------|
| 0 | success | 请求成功 |
| 500 | 服务器内部错误 | 服务器处理请求时发生未知错误 |

### 3.2 认证与授权相关返回码

| 返回码 | 消息 | 描述 |
|--------|------|------|
| 401 | 未认证或认证失败 | 用户未登录或登录凭证无效 |
| 403 | 访问被拒绝 | 用户没有权限执行该操作 |
| 4001 | 用户名或密码错误 | 登录时用户名或密码不正确 |
| 4002 | 用户名已存在 | 注册时用户名已被使用 |
| 4003 | 无效的令牌 | JWT令牌格式错误或已损坏 |
| 4004 | 令牌已过期 | JWT令牌已超过有效期 |
| 4005 | 令牌签名验证失败 | JWT令牌签名不匹配 |

### 3.3 参数验证相关返回码

| 返回码 | 消息 | 描述 |
|--------|------|------|
| 400 | 请求参数错误 | 请求参数格式不正确或缺少必要参数 |
| 4006 | 用户名不能为空 | 注册或登录时用户名为空 |
| 4007 | 密码不能为空 | 注册或登录时密码为空 |
| 4008 | 密码长度不足 | 密码长度不能少于6位 |
| 4009 | 身份证号码格式不正确 | 身份证号码格式不符合规范 |
| 4010 | 手机号码格式不正确 | 手机号码格式不符合规范 |
| 4011 | 邮箱格式不正确 | 邮箱格式不符合规范 |

### 3.4 用户相关返回码

| 返回码 | 消息 | 描述 |
|--------|------|------|
| 4012 | 用户不存在 | 根据用户名或ID无法找到用户 |
| 4013 | 用户已被禁用 | 用户账号已被管理员禁用 |
| 4014 | 原密码错误 | 修改密码时原密码不正确 |
| 4015 | 两次输入的密码不一致 | 修改密码时新密码与确认密码不一致 |

### 3.5 病人相关返回码

| 返回码 | 消息 | 描述 |
|--------|------|------|
| 4016 | 病人不存在 | 根据ID无法找到病人信息 |
| 4017 | 身份证号码已被注册 | 身份证号码已被其他病人使用 |

### 3.6 医生相关返回码

| 返回码 | 消息 | 描述 |
|--------|------|------|
| 4018 | 医生不存在 | 根据ID无法找到医生信息 |
| 4019 | 医生已被禁用 | 医生账号已被管理员禁用 |

### 3.7 预约相关返回码

| 返回码 | 消息 | 描述 |
|--------|------|------|
| 4020 | 预约不存在 | 根据ID无法找到预约信息 |
| 4021 | 预约时间已过 | 预约时间已超过当前时间 |
| 4022 | 医生该时间段已被预约 | 医生在该时间段已有其他预约 |
| 4023 | 预约已取消 | 预约已经被取消 |
| 4024 | 预约已完成 | 预约已经完成 |
| 4025 | 预约时间冲突 | 病人在该时间段已有其他预约 |

### 3.8 科室相关返回码

| 返回码 | 消息 | 描述 |
|--------|------|------|
| 4026 | 科室不存在 | 根据ID无法找到科室信息 |

### 3.9 药品相关返回码

| 返回码 | 消息 | 描述 |
|--------|------|------|
| 4027 | 药品不存在 | 根据ID无法找到药品信息 |
| 4028 | 药品库存不足 | 药品库存不足以满足请求 |

### 3.10 处方相关返回码

| 返回码 | 消息 | 描述 |
|--------|------|------|
| 4029 | 处方不存在 | 根据ID无法找到处方信息 |
| 4030 | 处方已失效 | 处方已经超过有效期 |

## 4. 返回码使用规范

1. **成功响应**：所有成功的请求都应返回`code=0`和`msg="success"`
2. **错误响应**：
   - 应使用最具体的返回码，避免使用通用的400或500
   - 错误消息应清晰描述问题，便于前端展示和用户理解
   - 对于参数验证错误，应具体指出哪个参数有问题
3. **一致性**：相同类型的错误应使用相同的返回码
4. **扩展性**：新增业务功能时，应按照分类添加新的返回码，避免与现有返回码冲突

## 5. 示例

### 5.1 成功响应示例

```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "id": 1,
    "username": "admin",
    "role": "ADMIN"
  }
}
```

### 5.2 失败响应示例

```json
{
  "code": 4002,
  "msg": "用户名已存在",
  "data": null
}
```

```json
{
  "code": 401,
  "msg": "未认证或认证失败",
  "data": null
}
```

## 6. 维护说明

1. 文档应随系统功能的扩展而更新
2. 新增返回码时，应按照分类顺序添加，避免重复
3. 废弃的返回码应在文档中标记，并说明替代方案
4. 所有开发人员应严格遵守此规范，确保系统返回码的一致性

## 7. 版本历史

| 版本 | 更新日期 | 更新内容 |
|------|----------|----------|
| v1.0 | 2025-12-14 | 初始版本，定义基本返回码规范 |
